<!--
sokker

Author : Kuntal Bhusan
Email : kuntal.bhusan@gmail.com

A two player (1v1) fun physics based soccer game. Player 1 (RED-left) controls the paddle using keyboard buttons W,S,A,D and Player 2 uses the Left,Right,Up and Down keyboard keys. The aim is to manoeuvre the ball and score a goal in the opposite court within the given time. Refresh the page to start a new game.

-->

<!DOCTYPE html>
<html>
<head>
  <title>soKKer</title>
  <meta charset="utf-8">

 
  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.14.2/build/matter.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


  <style>
  
	body {
	  text-align: center;
	  margin: 10px;
	}

	canvas {
	  margin: 20px auto;
	}


  
  </style>
  
</head>

<body>


  
<div id="gameContainer" style="height: 10px; width: 100%;"></div>

<b id="left_val" style="text-align:center;padding: 0 10em 1em 0;"><font color="red">Left Score = 0</font></b>
<b id="time_val" style="text-align:center;padding: 0 10em 1em 0;">Time left = 300</b>
<b id="right_val" style="text-align:center;padding: 0 2em 1em 0;"><font color="blue">Right Score = 0</font></b>



  <script>
  
  


$(document).keydown(function(e) {
    switch(e.which) {
    
        case 32: // space
	    Body.setPosition( ball, {x: 400, y: 200}); 
	    Body.setVelocity( ball, {x: 0, y: 0}); 
	    //Body.setPosition( car1.bodies[2], {x: 200, y: 300});
	    //Body.setPosition( car2.bodies[2], {x: 600, y: 300}); 
	break;  
    
        case 65: // a // left
	    Body.setVelocity( car1, {x: -5, y: 0});   
	break;     
 
        case 68: // d // right
	    Body.setVelocity( car1, {x: 5, y: 0}); 
	break;     
	
        case 87: // w // up 
	    Body.setVelocity( car1, {x: 0, y: -5});   
	break;     
 
        case 83: // s // down
	    Body.setVelocity( car1, {x: 0, y: 5}); 
	break; 	
 
 
 
 
 
    
        case 37: // left 
            //Body.applyForce( car2, {x: car2.position.x, y: car2.position.y}, {x: -0.005, y: 0}); 
	    Body.setVelocity( car2, {x: -3, y: 0});
	break;  
 
	
        case 39: // right  
             //Body.applyForce( car2, {x: car2.position.x, y: car2.position.y}, {x: 0.005, y: 0});
             Body.setVelocity( car2, {x: 3, y: 0});
        break;		            

        case 38: // up
             //Body.applyForce( car2, {x: car2.position.x, y: car2.position.y}, {x: 0, y: -0.005}); 
             Body.setVelocity( car2, {x: 0, y: -3});  
  
        break;

        case 40: // down      		
    	     //Body.applyForce( car2, {x: car2.position.x, y: car2.position.y}, {x: 0, y: -0.005});
    	     Body.setVelocity( car2, {x: 0, y: 3});       
        break;


        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});


var Engine = Matter.Engine,
  Runner = Matter.Runner,
  Render = Matter.Render,
  Composites = Matter.Composites,
  Constraint = Matter.Constraint,
  MouseConstraint = Matter.MouseConstraint, 
  Events = Matter.Events,
  World = Matter.World,
  Bodies = Matter.Bodies,
  Vector = Matter.Vector,
  Body = Matter.Body;
  
var left_score = 0;
var right_score = 0;
 

var engine = Engine.create();
engine.world.gravity.y = 0;

var render = Render.create({
  element: document.body,
  engine: engine,
  options: {
    width: 800,
    height: 400,
    wireframes: false
  }
});

var topWall = Bodies.rectangle(400, 50, 720, 20, { isStatic: true });
var leftWall = Bodies.rectangle(50, 210, 20, 300, { isStatic: true });
var rightWall = Bodies.rectangle(750, 210, 20, 300, { isStatic: true });
var bottomWall = Bodies.rectangle(400, 350, 720, 20, { isStatic: true });

var ball = Bodies.circle(400, 200, 10, { restitution: 0.8 });


//var car1 = Composites.car(200, 300, 50, 10, 10);   
//var car2 = Composites.car(600, 300, 50, 10, 10);  

var car1 = Bodies.circle(200, 150, 20);   
var car2 = Bodies.circle(600, 150, 20); 

car1.render.fillStyle = 'red';
car2.render.fillStyle = 'blue';


//car1.bodies[0].render.fillStyle = 'yellow';
//car1.bodies[1].render.fillStyle = 'red';
//car1.bodies[2].render.fillStyle = 'red';

//car2.bodies[0].render.fillStyle = 'green';
//car2.bodies[1].render.fillStyle = 'blue';
//car2.bodies[2].render.fillStyle = 'blue';

ball.render.fillStyle = 'white';

var boxA1 = Bodies.rectangle(120, 70, 10, 60,{ isStatic: true });
var boxA2 = Bodies.rectangle(120, 330, 10, 60,{ isStatic: true });
var boxB1 = Bodies.rectangle(680, 70, 10, 60,{ isStatic: true });
var boxB2 = Bodies.rectangle(680, 330, 10, 60,{ isStatic: true });

var boxC1 = Bodies.rectangle(135, 70, 10, 60,{ isStatic: true }); Body.rotate(boxC1, Math.PI/6);
var boxC2 = Bodies.rectangle(135, 330, 10, 60,{ isStatic: true });Body.rotate(boxC2, -Math.PI/6);
var boxD1 = Bodies.rectangle(665, 70, 10, 60,{ isStatic: true }); Body.rotate(boxD1, -Math.PI/6);
var boxD2 = Bodies.rectangle(665, 330, 10, 60,{ isStatic: true }); Body.rotate(boxD2, Math.PI/6);

boxA1.render.fillStyle = 'red';
boxA2.render.fillStyle = 'red';
boxB1.render.fillStyle = 'blue';
boxB2.render.fillStyle = 'blue';

boxC1.render.fillStyle = 'red';
boxC2.render.fillStyle = 'red';
boxD1.render.fillStyle = 'blue';
boxD2.render.fillStyle = 'blue';

leftWall.render.fillStyle = 'red';
rightWall.render.fillStyle = 'blue';



World.add(engine.world, [
	car1,
	car2,
	topWall, 
	leftWall, 
	rightWall, 
	bottomWall, 
	ball,
	boxA1,
	boxA2,
	boxB1,
	boxB2,
	boxC1,
	boxC2,
	boxD1,
	boxD2
]);


Engine.run(engine);

Render.run(render);


// create runner
    var runner = Runner.create();
    Runner.run(runner, engine);

    // an example of using beforeUpdate event on an engine
    Events.on(engine, 'beforeUpdate', function(event) {
        var engine = event.source;

        // apply random forces every 5 secs
        if (event.timestamp % 1000 < 50){
            var time =  parseInt(event.timestamp / 1000);
            var time_left = 300 - time;
            
            if(time_left > 0) 
            {
			    //console.log(time_left);
			    document.getElementById("time_val").innerHTML = "Time left = " + time_left;
			    
			    if(ball.position.x <= 120){
			    	console.log('LEFT GOAL');
			    	right_score += 1;
			    	document.getElementById("right_val").innerHTML = '<font color="blue">' + "Right score = " + right_score + '</font>';
			    	engine.timing.timeScale = 0.5;
			    	
			    	Body.setPosition( ball, {x: 400, y: 200});
			    	Body.setVelocity( ball, {x: 0, y: 0}); 
			    	
			        //Body.setPosition( car1, {x: 200, y: 150});
	    			//Body.setPosition( car2, {x: 600, y: 150}); 
	    			//Body.setVelocity( car1, {x: 0, y: 0});
	    			//Body.setVelocity( car2, {x: 0, y: 0});
			    }
			    
			    if(ball.position.x >= 680){
			    	console.log('RIGHT GOAL');
			    	left_score += 1;
			    	document.getElementById("left_val").innerHTML = '<font color="red">' + "Left score = " + left_score + '</font>';
			    	
			    	Body.setPosition( ball, {x: 400, y: 200});
			    	Body.setVelocity( ball, {x: 0, y: 0}); 
			    	
			    	//Body.setPosition( car1, {x: 200, y: 150});
	    			//Body.setPosition( car2, {x: 600, y: 150}); 
	    			//Body.setVelocity( car1, {x: 0, y: 0});
	    			//Body.setVelocity( car2, {x: 0, y: 0});
			    }
			    
			    
			    
			    move_ai(car1);
			    		    
	    }
	    else
	    {
	    			document.getElementById("time_val").innerHTML = "GAME OVER !!!";
	    }	    
        }
    });








    function move_ai(car1) {
    
    	var car_x = car1.position.x;
    	var car_y = car1.position.y;
    	
    	var ball_x = ball.position.x;
    	var ball_y = ball.position.y;
    	
    	var dx = Math.abs(ball_x - car_x);
    	var dy = Math.abs(ball_y - car_y);
    	
    	var fx = dx/100;
    	var fy = dy/100;
    	
    	
        
        if (ball_x > car_x && ball_y >= car_y) {
        
        //console.log('CAR LEFT UP');
        //console.log(car_x + ',' + car_y + ',' + ball_x + ',' + ball_y);
        //console.log(dx + ',' + dy + ',' + fx + ',' + fy);
        
	   if(dx >= dy)	        
           { 
           Body.setVelocity( car1, {x: 3, y: 1}); 
           }
           else
           { 
           Body.setVelocity( car1, {x: 1, y: 3}); 
           }
        }
        
        if (ball_x > car_x && ball_y <= car_y) {
        
        //console.log('CAR LEFT DOWN');
        //console.log(car_x + ',' + car_y + ',' + ball_x + ',' + ball_y);
        //console.log(dx + ',' + dy + ',' + fx + ',' + fy);
        	
	   if(dx >= dy)	        
           { 
           Body.setVelocity( car1, {x: 3, y: -1}); 
           }
           else
           { 
           Body.setVelocity( car1, {x: 1, y: -3}); 
           }
        }
                
        if (ball_x < car_x && ball_y >= car_y) {
        
        //console.log('CAR RIGHT UP');
        //console.log(car_x + ',' + car_y + ',' + ball_x + ',' + ball_y);
        //console.log(dx + ',' + dy + ',' + fx + ',' + fy);

	   if(dx >= dy)	        
           {
		   if(dx > 100)
		   { 
		   	Body.setVelocity( car1, {x: -3, y: 1}); 
		   }
		   else
		   {
		   	Body.setVelocity( car1, {x: 0, y: 3}); 
		   	Body.setVelocity( car1, {x: -2, y: 0});
		   }
           }
           else
           {
		   if(dx > 100)
		   {             
           	   	Body.setVelocity( car1, {x: -1, y: 3}); 
           	   }
           	   else
           	   {
           	   	Body.setVelocity( car1, {x: 0, y: 3}); 
           	   	Body.setVelocity( car1, {x: -2, y: 0});            	   
           	   }
           }
        }

        if (ball_x < car_x && ball_y <= car_y) {
        
        //console.log('CAR RIGHT DOWN');
        //console.log(car_x + ',' + car_y + ',' + ball_x + ',' + ball_y);
        //console.log(dx + ',' + dy + ',' + fx + ',' + fy);

	   if(dx >= dy)	        
           { 
		   if(dx > 100)
		   { 
		   	Body.setVelocity( car1, {x: -3, y: -1}); 
		   }
		   else
		   {
		   	Body.setVelocity( car1, {x: 0, y: -3}); 
		   	Body.setVelocity( car1, {x: -2, y: 0}); 
		   }           
           }
           else
           {
		   if(dx > 100)
		   { 
		   	Body.setVelocity( car1, {x: -1, y: -3}); 
		   }
		   else
		   {
		   	Body.setVelocity( car1, {x: 0, y: -3}); 
		   	Body.setVelocity( car1, {x: -2, y: 0}); 
		   }                

           }
        }             
                

    }











  
  </script>

</body>
</html>
